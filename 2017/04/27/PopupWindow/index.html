<!DOCTYPE html>
<html lang="">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yeshu.work","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="PopupWindow生成PopupWindow final View contentView &#x3D; LayoutInflater.from(context).inflate(R.layout.guide_view, null);contentView.measure(View.MeasureSpec.UNSPECIFIED, View.MeasureSpec.UNSPECIFIED);mPopup">
<meta property="og:type" content="article">
<meta property="og:title" content="PopupWindow">
<meta property="og:url" content="http://yeshu.work/2017/04/27/PopupWindow/index.html">
<meta property="og:site_name" content="yeshu blog">
<meta property="og:description" content="PopupWindow生成PopupWindow final View contentView &#x3D; LayoutInflater.from(context).inflate(R.layout.guide_view, null);contentView.measure(View.MeasureSpec.UNSPECIFIED, View.MeasureSpec.UNSPECIFIED);mPopup">
<meta property="og:locale">
<meta property="article:published_time" content="2017-04-27T07:19:58.000Z">
<meta property="article:modified_time" content="2022-06-07T10:53:41.440Z">
<meta property="article:author" content="yeshu">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yeshu.work/2017/04/27/PopupWindow/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'default'
  };
</script>

  <title>PopupWindow | yeshu blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">yeshu blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yeshu.work/2017/04/27/PopupWindow/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yeshu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yeshu blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          PopupWindow
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-04-27 15:19:58" itemprop="dateCreated datePublished" datetime="2017-04-27T15:19:58+08:00">2017-04-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-06-07 18:53:41" itemprop="dateModified" datetime="2022-06-07T18:53:41+08:00">2022-06-07</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="PopupWindow"><a href="#PopupWindow" class="headerlink" title="PopupWindow"></a>PopupWindow</h1><p>生成<code>PopupWindow</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">final</span> View contentView = LayoutInflater.from(context).inflate(R.layout.guide_view, <span class="keyword">null</span>);</span><br><span class="line">contentView.measure(View.MeasureSpec.UNSPECIFIED, View.MeasureSpec.UNSPECIFIED);</span><br><span class="line">mPopupWindow = <span class="keyword">new</span> PopupWindow(contentView, ViewGroup.LayoutParams.MATCH_PARENT, contentView.getMeasuredHeight());</span><br></pre></td></tr></table></figure>

<p>设置属性</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">mPopupWindow.setBackgroundDrawable(<span class="keyword">new</span> ColorDrawable()); <span class="comment">//设置背景</span></span><br><span class="line">mPopupWindow.setOutsideTouchable(<span class="keyword">true</span>); <span class="comment">//设置可以接收外部action_outside事件</span></span><br><span class="line">mPopupWindow.setFocusable(<span class="keyword">true</span>);    <span class="comment">//设置PopuoWindow处理所有事件，否则会将事件传递給后面的View</span></span><br></pre></td></tr></table></figure>

<p>显示</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//显示在制定View下方，当下方空间不够时会显示到上方</span></span><br><span class="line">mPopupWindow.showAsDropDown(View view);</span><br><span class="line"><span class="comment">//显示在制定的坐标位置</span></span><br><span class="line">mPopuoWindow.showAtLocation();</span><br></pre></td></tr></table></figure>

<h3 id="点击返回键和touch-outside隐藏popupwindow"><a href="#点击返回键和touch-outside隐藏popupwindow" class="headerlink" title="点击返回键和touch outside隐藏popupwindow"></a>点击返回键和touch outside隐藏popupwindow</h3><p>popupWindow默认显示出来后，点击返回和touch outside不会隐藏，popupWindow对返回键和outside events的默认处理就是隐藏界面，只是默认的popupWindow接收不到outside touch events 和 key events</p>
<h4 id="让它可以接收到outside-touch-events-实现touch-outside隐藏"><a href="#让它可以接收到outside-touch-events-实现touch-outside隐藏" class="headerlink" title="让它可以接收到outside touch events, 实现touch outside隐藏"></a>让它可以接收到outside touch events, 实现touch outside隐藏</h4><p>android 6.0以下需要设置背景</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">mPopupWindow.setBackgroundDrawable(<span class="keyword">new</span> ColorDrawable());</span><br><span class="line">mPopupWindow.setOutsideTouchable(<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>

<p>android 6.0只需要</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">mPopupWindow.setOutsideTouchable(<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>

<p>但是上面只是实现了touch outside隐藏，因为现在popupwindow focusable为false,接收不到key events, 所以返回键无效,并且现在的touch events底层的window也能接收到点击事件</p>
<h4 id="让它可以接收到key-events-实现点击返回键隐藏"><a href="#让它可以接收到key-events-实现点击返回键隐藏" class="headerlink" title="让它可以接收到key events, 实现点击返回键隐藏"></a>让它可以接收到key events, 实现点击返回键隐藏</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">mPopupWindow.setFocusable(<span class="keyword">true</span>);<span class="comment">//当前的window接收并处理所有的key events</span></span><br></pre></td></tr></table></figure>

<h4 id="完整的实现"><a href="#完整的实现" class="headerlink" title="完整的实现"></a>完整的实现</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">mPopupWindow.setBackgroundDrawable(<span class="keyword">new</span> ColorDrawable());</span><br><span class="line">mPopupWindow.setOutsideTouchable(<span class="keyword">true</span>);</span><br><span class="line">mPopupWindow.setFocusable(<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>



<h2 id="WindowManager-LayoutParams"><a href="#WindowManager-LayoutParams" class="headerlink" title="WindowManager.LayoutParams"></a>WindowManager.LayoutParams</h2><ul>
<li><p>FLAG_NOT_FOCUSABLE (focusable时，能收到按键事件，并且touch events只交给当前window处理，不往底层传递)</p>
<pre><code>  this window won&#39;t ever get key input focus, so the user can not send key or other button events to it. Those will instead go to whatever focusable window is behind it. This flag will also enable FLAG_NOT_TOUCH_MODAL whether or not that is explicitly set.
</code></pre>
</li>
<li><p>FLAG_NOT_TOUCH_MODAL（not touch modal时，outside touch events会发送给自己消费，不往底层传递(focusable时就会自动变成这个状态)）</p>
<pre><code>   even when this window is focusable (its FLAG_NOT_FOCUSABLE is not set), allow any pointer events outside of the window to be sent to the windows behind it. Otherwise it will consume all pointer events itself, regardless of whether they are inside of the window.

  
</code></pre>
</li>
<li><p>FLAG_NOT_TOUCHABLE （能否接收到touch events）</p>
<pre><code>  Window flag: this window can never receive touch events.
</code></pre>
</li>
<li><p>FLAG_WATCH_OUTSIDE_TOUCH (not touch modal 时，能否接收到outside touch events)</p>
<pre><code>  if you have set FLAG_NOT_TOUCH_MODAL, you can set this flag to receive a single special MotionEvent with the action MotionEvent.ACTION_OUTSIDE for touches that occur outside of your window. Note that you will not receive the full down/move/up gesture, only the location of the first down as an ACTION_OUTSIDE.
</code></pre>
</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2017/04/01/Android%E6%97%A5%E5%BF%97%E6%89%93%E5%8D%B0/" rel="prev" title="Android日志打印">
      <i class="fa fa-chevron-left"></i> Android日志打印
    </a></div>
      <div class="post-nav-item">
    <a href="/2017/09/05/Fragment%E4%BD%BF%E7%94%A8%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/" rel="next" title="Fragment使用中的常见异常">
      Fragment使用中的常见异常 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#PopupWindow"><span class="nav-number">1.</span> <span class="nav-text">PopupWindow</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%82%B9%E5%87%BB%E8%BF%94%E5%9B%9E%E9%94%AE%E5%92%8Ctouch-outside%E9%9A%90%E8%97%8Fpopupwindow"><span class="nav-number">1.0.1.</span> <span class="nav-text">点击返回键和touch outside隐藏popupwindow</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%A9%E5%AE%83%E5%8F%AF%E4%BB%A5%E6%8E%A5%E6%94%B6%E5%88%B0outside-touch-events-%E5%AE%9E%E7%8E%B0touch-outside%E9%9A%90%E8%97%8F"><span class="nav-number">1.0.1.1.</span> <span class="nav-text">让它可以接收到outside touch events, 实现touch outside隐藏</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%A9%E5%AE%83%E5%8F%AF%E4%BB%A5%E6%8E%A5%E6%94%B6%E5%88%B0key-events-%E5%AE%9E%E7%8E%B0%E7%82%B9%E5%87%BB%E8%BF%94%E5%9B%9E%E9%94%AE%E9%9A%90%E8%97%8F"><span class="nav-number">1.0.1.2.</span> <span class="nav-text">让它可以接收到key events, 实现点击返回键隐藏</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.0.1.3.</span> <span class="nav-text">完整的实现</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WindowManager-LayoutParams"><span class="nav-number">1.1.</span> <span class="nav-text">WindowManager.LayoutParams</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">yeshu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">138</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/yeshu-cn" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;yeshu-cn" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yeshu</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
